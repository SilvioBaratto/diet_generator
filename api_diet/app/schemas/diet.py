"""Diet-related Pydantic schemas"""

from datetime import datetime
from typing import Optional, List
from pydantic import BaseModel, ConfigDict
from baml_client.types import TipoPasto, Ingrediente, HtmlStructure


class UserSettingsIn(BaseModel):
    """Input schema for user settings"""
    model_config = ConfigDict(from_attributes=True)

    weight: Optional[float] = None     # kg
    height: Optional[float] = None     # cm
    other_data: Optional[str] = None
    goals: Optional[str] = None


class UserSettingsOut(UserSettingsIn):
    """Output schema for user settings"""
    id: str
    user_id: str
    created_at: datetime
    updated_at: datetime


class DietSummary(BaseModel):
    """Summary schema for diet listing"""
    model_config = ConfigDict(from_attributes=True)

    id: str
    name: Optional[str] = None
    created_at: datetime


class PastoSchema(BaseModel):
    """Schema for individual meal/pasto"""
    model_config = ConfigDict(from_attributes=True)

    id: str
    tipoPasto: TipoPasto
    ingredienti: List[Ingrediente]
    calorie: int
    day: int  # 0 = Monday, 1 = Tuesday, ..., 6 = Sunday


class DietaSettimanaleSchema(BaseModel):
    """Schema for weekly diet plan"""
    nome: str
    dataInizio: str
    dataFine: str
    pasti: List[PastoSchema]


class DietaConLista(BaseModel):
    """Schema for diet with grocery list"""
    dieta: DietaSettimanaleSchema
    listaSpesa: "ListaSpesaSchema"


class RecipeResponse(BaseModel):
    """Schema for recipe response"""
    recipe: HtmlStructure


# Import ListaSpesaSchema from baml_client
from baml_client.types import ListaSpesa as ListaSpesaSchema

# Update the forward reference
DietaConLista.model_rebuild()